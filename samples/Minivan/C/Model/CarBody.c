/* File generated by Đức's ClasHStamP */
#define __CarBody_INTERNAL__
#include "CommonInclude.h"
#include "CarBody.h"
#include "ObjsBuilder.h"                                        
/** @public @memberof CarBody */
void CarBody_moveRight(
    CarBody* pCarBody
){
    pCarBody->x += 2;
    pCarBody->m_offset.x = pCarBody->x;

    CarWheel_rotateCW( frontWheels );
    CarWheel_rotateCW( rearWheels );
} /* CarBody_moveRight */

/** @public @memberof CarBody */
void CarBody_moveLeft(
    CarBody* pCarBody
){
    pCarBody->x -= 2;
    pCarBody->m_offset.x = pCarBody->x;
    pCarBody->m_angle = 30.;

    CarWheel_rotateCCW( frontWheels );
    CarWheel_rotateCCW( rearWheels );
} /* CarBody_moveLeft */

const TCHAR* CarBodyEvent_toString( CarBody_EVENT value ){
    switch( value ){
    case CarBody_L_KEY_HIT: return _T( "L_KEY_HIT" );
    case CarBody_R_KEY_HIT: return _T( "R_KEY_HIT" );
    case CarBody_TICK: return _T( "TICK" );
    default: return _T( "CarBody_UNKNOWN" );
    }
}
static void CarStm_BgnTrans( CarBody *pCarTop, CarStm* pStm, uint64_t targetState, uint64_t initState );
static void CarStm_EndTrans( CarBody *pCarTop, CarStm* pStm );
static BOOL CarStm_Reset( CarBody* pCarTop, CarStm* pStm, HdStateMachine* pParentStm, uint64_t nEntryPoint );
static BOOL CarStm_Abort( CarBody* pCarTop, CarStm* pStm );
static BOOL CarStm_EventProc( CarBody* pCarTop, CarStm* pStm, CarBody_EVENT nEventId, void* pEventParams );
static BOOL CarStm_RunToCompletion( CarBody* pCarTop, CarStm* pStm );
static void CarStm_GoingRight_Entry( CarBody* pCarBody, CarStm* pStm ){
    if( HdStateMachine_Enterable( &pStm->base, CarStm_GoingRight ) ){
        ShowEntry( "Model/CarBody/CarStm	143	148	224	52	0	0	660	500" );
    }
}
static BOOL CarStm_GoingRight_EventProc( CarBody* pCarBody, CarStm* pStm, CarBody_EVENT nEventId, void* pEventParams ){
    BOOL bResult = FALSE;
    pStm->base.nSourceState = CarStm_GoingRight;
    ShowDoing( "Model/CarBody/CarStm	143	148	224	52	0	0	660	500" );
    switch( nEventId ){
    case CarBody_L_KEY_HIT:{
        CarStm_BgnTrans( pCarBody, pStm, CarStm_GoingLeft, STATE_UNDEF );
        CarStm_EndTrans( pCarBody, pStm );
        bResult = TRUE;
    } break;
    case CarBody_TICK:{
        CarBody_moveRight(carBody);
        bResult = TRUE;
    } break;
    default: break;
    }
    return bResult;
}
static void CarStm_GoingRight_Exit( CarBody* pCarBody, CarStm* pStm ){
    if( HdStateMachine_Exitable( &pStm->base, CarStm_GoingRight ) ){ 
        ShowExit( "Model/CarBody/CarStm	143	148	224	52	0	0	660	500" );
    }
}
static void CarStm_GoingLeft_Entry( CarBody* pCarBody, CarStm* pStm ){
    if( HdStateMachine_Enterable( &pStm->base, CarStm_GoingLeft ) ){
        ShowEntry( "Model/CarBody/CarStm	146	274	218	52	0	0	660	500" );
    }
}
static BOOL CarStm_GoingLeft_EventProc( CarBody* pCarBody, CarStm* pStm, CarBody_EVENT nEventId, void* pEventParams ){
    BOOL bResult = FALSE;
    pStm->base.nSourceState = CarStm_GoingLeft;
    ShowDoing( "Model/CarBody/CarStm	146	274	218	52	0	0	660	500" );
    switch( nEventId ){
    case CarBody_R_KEY_HIT:{
        CarStm_BgnTrans( pCarBody, pStm, CarStm_GoingRight, STATE_UNDEF );
        CarStm_EndTrans( pCarBody, pStm );
        bResult = TRUE;
    } break;
    case CarBody_TICK:{
        CarBody_moveLeft(carBody);
        bResult = TRUE;
    } break;
    default: break;
    }
    return bResult;
}
static void CarStm_GoingLeft_Exit( CarBody* pCarBody, CarStm* pStm ){
    if( HdStateMachine_Exitable( &pStm->base, CarStm_GoingLeft ) ){ 
        ShowExit( "Model/CarBody/CarStm	146	274	218	52	0	0	660	500" );
    }
}
static void CarStm_EndTrans( CarBody *pCarBody, CarStm* pStm ){
    pStm->base.nCurrentState = pStm->base.nTargetState;
    pStm->base.bIsExternTrans = FALSE;
    switch( pStm->base.nCurrentState ){
    case CarStm_GoingRight:     CarStm_GoingRight_Entry( pCarBody, pStm ); break;
    case CarStm_GoingLeft:      CarStm_GoingLeft_Entry( pCarBody, pStm ); break;
    default: break;
    }
}
static void CarStm_BgnTrans( CarBody *pCarBody, CarStm* pStm, uint64_t targetState, uint64_t initState ){
    pStm->base.nTargetState = targetState;
    pStm->base.nPseudostate = targetState;
    if( initState ){
        pStm->base.nPseudostate = initState;
    }
    switch( pStm->base.nCurrentState ){
    case CarStm_GoingRight:     CarStm_GoingRight_Exit( pCarBody, pStm ); break;
    case CarStm_GoingLeft:      CarStm_GoingLeft_Exit( pCarBody, pStm ); break;
    default: break;
    }
}
static BOOL CarStm_StateDefaultTrans( CarBody* pCarBody, CarStm* pStm ){
    BOOL bResult = FALSE;
    pStm->base.nSourceState = pStm->base.nCurrentState;
    pStm->base.nLCAState = STATE_UNDEF;
    do{   if( pStm->base.nPseudostate == CarStm_InitialPseudostate0 ){
        CarStm_BgnTrans( pCarBody, pStm, CarStm_GoingRight, STATE_UNDEF );
        CarStm_EndTrans( pCarBody, pStm );
        bResult = TRUE;
    }else if( pStm->base.nCurrentState != pStm->base.nPseudostate && IS_IN(pStm->base.nPseudostate, CarStm_CarTop) ){
        CarStm_BgnTrans( pCarBody, pStm, pStm->base.nPseudostate, STATE_UNDEF );
        CarStm_EndTrans( pCarBody, pStm );
        bResult = TRUE;
    }else{
    }   }while( FALSE );
    return bResult;
}
static BOOL CarStm_RunToCompletion( CarBody* pCarBody, CarStm* pStm ){
    BOOL bResult;
    do{
        bResult = CarStm_StateDefaultTrans( pCarBody, pStm );
    } while ( bResult );
    return bResult;
}
static BOOL CarStm_Reset( CarBody* pCarBody, CarStm* pStm, HdStateMachine* pParentStm, uint64_t nEntryPoint ) {
    pStm->base.pParentStm = pParentStm;
    if( nEntryPoint == NULL ){
        if( CarStm_IsFinished( &pStm->base ) ){
            pStm->base.nPseudostate = CarStm_InitialPseudostate0;
        }
        return FALSE;
    }else{
    if( !IS_IN( nEntryPoint, CarStm_CarTop ) ){ return FALSE; }
        if( CarStm_IsFinished( &pStm->base ) ){
            pStm->base.nPseudostate = nEntryPoint;
            return FALSE;
        }else{
            pStm->base.nPseudostate = nEntryPoint;
        }
    }
    return TRUE;
}
static BOOL CarStm_EventProc( CarBody* pCarBody, CarStm* pStm, CarBody_EVENT nEventId, void* pEventParams ){
    BOOL bResult = FALSE;
    pStm->base.nLCAState = STATE_UNDEF;
    switch( pStm->base.nCurrentState ){
    case CarStm_GoingRight:                     bResult |= CarStm_GoingRight_EventProc( pCarBody, pStm, nEventId, pEventParams ); break;
    case CarStm_GoingLeft:                      bResult |= CarStm_GoingLeft_EventProc( pCarBody, pStm, nEventId, pEventParams ); break;
    default: break;
    }
    CarStm_RunToCompletion( pCarBody, pStm );
    return bResult;
}
static BOOL CarStm_IsIn( CarStm* pStm, uint64_t nCompositeState ) {
    if( IS_IN( pStm->base.nCurrentState, nCompositeState ) ){ return TRUE; }
    return FALSE;
}
static BOOL CarStm_Abort( CarBody* pCarBody, CarStm* pStm ) {
    pStm->base.nSourceState = CarStm_CarTop;
    CarStm_BgnTrans( pCarBody, pStm, CarStm_CarTop, STATE_UNDEF );
    CarStm_EndTrans( pCarBody, pStm );
    return TRUE;
}
int CarStm_IsFinished(CarStm* pCarStm){
    return pCarStm->base.nCurrentState == CarStm_CarTop && pCarStm->base.nCurrentState == pCarStm->base.nPseudostate;
}
BOOL CarBody_EventProc( CarBody* pCarBody, CarBody_EVENT nEventId, void* pEventParams ){
    return CarStm_EventProc( pCarBody, &pCarBody->mainStm, nEventId, pEventParams );
}
BOOL CarBody_Start( CarBody* pCarBody ){
    CarStm_Abort( pCarBody, &pCarBody->mainStm );
    CarStm_Reset( pCarBody, &pCarBody->mainStm, NULL, STATE_UNDEF );
    return CarStm_RunToCompletion( pCarBody, &pCarBody->mainStm );
}
BOOL CarBody_Reset( CarBody* pCarBody, uint64_t nEntryPoint ){
    return CarStm_Reset( pCarBody, &pCarBody->mainStm, NULL, nEntryPoint );
}
BOOL CarBody_IsIn( CarBody* pCarBody, uint64_t nState ){
    return CarStm_IsIn( &pCarBody->mainStm, nState );
}
ImgSprite* CarBody_Copy( CarBody* pCarBody, const CarBody* pSource ){
    ImgSprite_Copy( ( ImgSprite* )pCarBody, ( ImgSprite* )pSource );
    pCarBody->x = pSource->x;
    return ( Sprite* )pCarBody;
}
