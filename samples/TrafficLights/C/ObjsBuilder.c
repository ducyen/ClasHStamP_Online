/* File generated by Đức's ClasHStamP */
#define __ObjsBuilder_INTERNAL__
#include "CommonInclude.h"
#include "ObjsBuilder.h"
#include "ContextImpl.h"                                        
#include "GreenLight.h"                                         
#include "YellowLight.h"                                        
#include "RedLight.h"                                           
#include "Primitive.h"                                          
#include "TranslationConstraint.h"                              
#include "AttachmentConstraint.h"                               
#include "RotationConstraint.h"                                 
#include "TrackToConstraint.h"                                  
Sprite* g_objects[] = {
    &RedLight_Ctor( RedLight_Init(                              /* westRedLight */
        P( { 0.3042725173210162, 0.41036806363823086, 0.06062355658198614, 0.07268892540356313 } )/* m_iniRect */,
        P( "RedLight.png" )                                     /* m_imgPath */,
        P( null )/* m_constraints */
    ), ),
    &RedLight_Ctor( RedLight_Init(                              /* eastRedLight */
        P( { 0.6385681293302541, 0.5204598067574969, 0.06062355658198614, 0.07268892540356313 } )/* m_iniRect */,
        P( "RedLight.png" )                                     /* m_imgPath */,
        P( &AttachmentConstraint_Ctor( AttachmentConstraint_Init( &eastGreenLight, 1, 
           &TranslationConstraint_Ctor( TranslationConstraint_Init( &eastGreenLight, 1, 
           &RotationConstraint_Ctor( RotationConstraint_Init( &eastGreenLight, 0, 
           null ) ) ) ) ) ) )/* m_constraints */
    ), ),
    &YellowLight_Ctor( YellowLight_Init(                        /* westYellowLight */
        P( { 0.2528868360277136, 0.41036806363823086, 0.06062355658198614, 0.07268892540356313 } )/* m_iniRect */,
        P( "YellowLight.png" )                                  /* m_imgPath */,
        P( null )                                               /* m_constraints */
    ), ),
    &GreenLight_Ctor( GreenLight_Init(                          /* westGreenLight */
        P( { 0.20207852193995382, 0.41036806363823086, 0.06062355658198614, 0.07268892540356313 } )/* m_iniRect */,
        P( "GreenLight.png" )                                   /* m_imgPath */,
        P( null )                                               /* m_constraints */
    ), ),
    &YellowLight_Ctor( YellowLight_Init(                        /* eastYellowLight */
        P( { 0.6882217090069284, 0.5204598067574969, 0.06062355658198614, 0.07268892540356313 } )/* m_iniRect */,
        P( "YellowLight.png" )                                  /* m_imgPath */,
        P( &TrackToConstraint_Ctor( TrackToConstraint_Init( &eastGreenLight, 1, 
           null ) ) )/* m_constraints */
    ), ),
    &GreenLight_Ctor( GreenLight_Init(                          /* eastGreenLight */
        P( { 0.7390300230946882, 0.5204598067574969, 0.06062355658198614, 0.07268892540356313 } )/* m_iniRect */,
        P( "GreenLight.png" )                                   /* m_imgPath */,
        P( null )/* m_constraints */
    ), ),
    &RedLight_Ctor( RedLight_Init(                              /* northRedLight */
        P( { 0.5646651270207852, 0.2579392672531836, 0.06062355658198614, 0.07268892540356313 } )/* m_iniRect */,
        P( "RedLight.png" )                                     /* m_imgPath */,
        P( null )                                               /* m_constraints */
    ), ),
    &YellowLight_Ctor( YellowLight_Init(                        /* northYellowLight */
        P( { 0.5646651270207852, 0.19588999526450318, 0.06062355658198614, 0.07268892540356313 } )/* m_iniRect */,
        P( "YellowLight.png" )                                  /* m_imgPath */,
        P( null )                                               /* m_constraints */
    ), ),
    &GreenLight_Ctor( GreenLight_Init(                          /* northGreenLight */
        P( { 0.5646651270207852, 0.13438559068191155, 0.06062355658198614, 0.07268892540356313 } )/* m_iniRect */,
        P( "GreenLight.png" )                                   /* m_imgPath */,
        P( null )                                               /* m_constraints */
    ), ),
    &RedLight_Ctor( RedLight_Init(                              /* southRedLight */
        P( { 0.39838337182448036, 0.5930327219978091, 0.06062355658198614, 0.07268892540356313 } )/* m_iniRect */,
        P( "RedLight.png" )                                     /* m_imgPath */,
        P( null )                                               /* m_constraints */
    ), ),
    &YellowLight_Ctor( YellowLight_Init(                        /* southYellowLight */
        P( { 0.39838337182448036, 0.6556782101533617, 0.06062355658198614, 0.07268892540356313 } )/* m_iniRect */,
        P( "YellowLight.png" )                                  /* m_imgPath */,
        P( null )                                               /* m_constraints */
    ), ),
    &GreenLight_Ctor( GreenLight_Init(                          /* southGreenLight */
        P( { 0.39838337182448036, 0.7171826147359532, 0.06062355658198614, 0.07268892540356313 } )/* m_iniRect */,
        P( "GreenLight.png" )                                   /* m_imgPath */,
        P( null )                                               /* m_constraints */
    ), ),
    &Primitive_Ctor( Primitive_Init(                            /* Rectangle_4fh */
        P( { 0.04503464203233257, 0.06982869839449543, 0.3371824480369515, 0.3241590214067278 } )/* 4fh-26d23a6dbabdf00606cec0dc8ca46101 */,
        P( "Rectangle 000000 line 1 null FFFFFF null" )         /* Rectangle_4fh */
    ), ),
    &Primitive_Ctor( Primitive_Init(                            /* Rectangle_phs */
        P( { 0.6339491916859122, 0.06982869839449542, 0.3371824480369515, 0.3241590214067278 } )/* phs-6f7de2bd597eab2992ffddef9cceacc8 */,
        P( "Rectangle 000000 line 1 null FFFFFF null" )         /* Rectangle_phs */
    ), ),
    &Primitive_Ctor( Primitive_Init(                            /* Rectangle_ps7 */
        P( { 0.04503464203233257, 0.6371069858562691, 0.3371824480369515, 0.3241590214067278 } )/* ps7-6f7de2bd597eab2992ffddef9cceacc8 */,
        P( "Rectangle 000000 line 1 null FFFFFF null" )         /* Rectangle_ps7 */
    ), ),
    &Primitive_Ctor( Primitive_Init(                            /* Rectangle_q2m */
        P( { 0.6339491916859122, 0.6371069858562691, 0.3371824480369515, 0.3241590214067278 } )/* q2m-6f7de2bd597eab2992ffddef9cceacc8 */,
        P( "Rectangle 000000 line 1 null FFFFFF null" )         /* Rectangle_q2m */
    ), ),
    &Primitive_Ctor( Primitive_Init(                            /* Oval_rex */
        P( { 0.2921478060046189, 0.22359455351301585, 0.04041570438799076, 0.05198776758409788 } )/* rex-6f7de2bd597eab2992ffddef9cceacc8 */,
        P( "Oval 000000 line 1 true 66FF33 oval" )              /* Oval_rex */
    ), ),
    &Primitive_Ctor( Primitive_Init(                            /* Oval_rlz */
        P( { 0.2840646651270208, 0.25417559326836753, 0.04041570438799076, 0.05198776758409788 } )/* rlz-6f7de2bd597eab2992ffddef9cceacc8 */,
        P( "Oval 000000 line 1 true 66FF33 oval" )              /* Oval_rlz */
    ), ),
    &Primitive_Ctor( Primitive_Init(                            /* Oval_rwe */
        P( { 0.2979214780600462, 0.25417559326836753, 0.04041570438799076, 0.05198776758409788 } )/* rwe-6f7de2bd597eab2992ffddef9cceacc8 */,
        P( "Oval 000000 line 1 true 66FF33 oval" )              /* Oval_rwe */
    ), ),
    &Primitive_Ctor( Primitive_Init(                            /* Rectangle_sbx */
        P( { 0.30600461893764436, 0.29851810091362746, 0.012702078521939953, 0.03211009174311927 } )/* sbx-6f7de2bd597eab2992ffddef9cceacc8 */,
        P( "Rectangle 000000 line 1 true 996633 null" )         /* Rectangle_sbx */
    ), ),
    &Primitive_Ctor( Primitive_Init(                            /* Oval_swa */
        P( { 0.7286374133949192, 0.24076691038309972, 0.04041570438799076, 0.05198776758409788 } )/* swa-6f7de2bd597eab2992ffddef9cceacc8 */,
        P( "Oval 000000 line 1 true 66FF33 oval" )              /* Oval_swa */
    ), ),
    &Primitive_Ctor( Primitive_Init(                            /* Oval_swb */
        P( { 0.7205542725173211, 0.2713479501384514, 0.04041570438799076, 0.05198776758409788 } )/* swb-6f7de2bd597eab2992ffddef9cceacc8 */,
        P( "Oval 000000 line 1 true 66FF33 oval" )              /* Oval_swb */
    ), ),
    &Primitive_Ctor( Primitive_Init(                            /* Oval_swc */
        P( { 0.7344110854503464, 0.2713479501384514, 0.04041570438799076, 0.05198776758409788 } )/* swc-6f7de2bd597eab2992ffddef9cceacc8 */,
        P( "Oval 000000 line 1 true 66FF33 oval" )              /* Oval_swc */
    ), ),
    &Primitive_Ctor( Primitive_Init(                            /* Rectangle_swd */
        P( { 0.7424942263279446, 0.31569045778371135, 0.012702078521939953, 0.03211009174311927 } )/* swd-6f7de2bd597eab2992ffddef9cceacc8 */,
        P( "Rectangle 000000 line 1 true 996633 null" )         /* Rectangle_swd */
    ), ),
    &Primitive_Ctor( Primitive_Init(                            /* Oval_tjf */
        P( { 0.7090069284064665, 0.7171826147359532, 0.04041570438799076, 0.05198776758409788 } )/* tjf-6f7de2bd597eab2992ffddef9cceacc8 */,
        P( "Oval 000000 line 1 true 66FF33 oval" )              /* Oval_tjf */
    ), ),
    &Primitive_Ctor( Primitive_Init(                            /* Oval_tjg */
        P( { 0.7009237875288684, 0.7477636544913049, 0.04041570438799076, 0.05198776758409788 } )/* tjg-6f7de2bd597eab2992ffddef9cceacc8 */,
        P( "Oval 000000 line 1 true 66FF33 oval" )              /* Oval_tjg */
    ), ),
    &Primitive_Ctor( Primitive_Init(                            /* Oval_tjh */
        P( { 0.7147806004618937, 0.7477636544913049, 0.04041570438799076, 0.05198776758409788 } )/* tjh-6f7de2bd597eab2992ffddef9cceacc8 */,
        P( "Oval 000000 line 1 true 66FF33 oval" )              /* Oval_tjh */
    ), ),
    &Primitive_Ctor( Primitive_Init(                            /* Rectangle_tji */
        P( { 0.7228637413394919, 0.7921061621365649, 0.012702078521939953, 0.03211009174311927 } )/* tji-6f7de2bd597eab2992ffddef9cceacc8 */,
        P( "Rectangle 000000 line 1 true 996633 null" )         /* Rectangle_tji */
    ), ),
    &Primitive_Ctor( Primitive_Init(                            /* Oval_u0q */
        P( { 0.26096997690531176, 0.7334372610856269, 0.04041570438799076, 0.05198776758409788 } )/* u0q-6f7de2bd597eab2992ffddef9cceacc8 */,
        P( "Oval 000000 line 1 true 66FF33 oval" )              /* Oval_u0q */
    ), ),
    &Primitive_Ctor( Primitive_Init(                            /* Oval_u0r */
        P( { 0.2528868360277136, 0.7640183008409785, 0.04041570438799076, 0.05198776758409788 } )/* u0r-6f7de2bd597eab2992ffddef9cceacc8 */,
        P( "Oval 000000 line 1 true 66FF33 oval" )              /* Oval_u0r */
    ), ),
    &Primitive_Ctor( Primitive_Init(                            /* Oval_u0s */
        P( { 0.26674364896073904, 0.7640183008409785, 0.04041570438799076, 0.05198776758409788 } )/* u0s-6f7de2bd597eab2992ffddef9cceacc8 */,
        P( "Oval 000000 line 1 true 66FF33 oval" )              /* Oval_u0s */
    ), ),
    &Primitive_Ctor( Primitive_Init(                            /* Rectangle_u0t */
        P( { 0.2748267898383372, 0.8083608084862385, 0.012702078521939953, 0.03211009174311927 } )/* u0t-6f7de2bd597eab2992ffddef9cceacc8 */,
        P( "Rectangle 000000 line 1 true 996633 null" )         /* Rectangle_u0t */
    ), )
};
Sprite* getobj( int id ){
    return g_objects[ id ];
}
int ObjsBuilder_startSim(
    void  
){
    SDL_Window *window = NULL;
    SDL_Renderer *renderer = NULL;
    SDL_Surface *imageSurface = NULL;
    SDL_Texture *imageTexture = NULL;

    int nResult = S_OK;

    if (SDL_Init(SDL_INIT_VIDEO) < 0) {
        printf("SDL could not initialize! SDL_Error: %s\n", SDL_GetError());
        nResult = S_FALSE;
    }

    int SCREEN_WIDTH = 640;
    int SCREEN_HEIGHT = 480;

    if (nResult == S_OK) {
        // Load image
        char sRelPath[256];
        sprintf(sRelPath, "%s/%s", getInputDir(), "ObjsBuilder/Main.png");
        imageSurface = IMG_Load(sRelPath);
        if (imageSurface == NULL) {
            printf("Unable to load image! SDL_image Error: %s\n", IMG_GetError());
            nResult = S_FALSE;
        } else {
            SCREEN_WIDTH = imageSurface->w;
            SCREEN_HEIGHT = imageSurface->h;
        }
    }

    if (nResult == S_OK) {
        window = SDL_CreateWindow("SDL Tutorial", SDL_WINDOWPOS_UNDEFINED, SDL_WINDOWPOS_UNDEFINED, SCREEN_WIDTH, SCREEN_HEIGHT, SDL_WINDOW_SHOWN);
        if (window == NULL) {
            printf("Window could not be created! SDL_Error: %s\n", SDL_GetError());
            nResult = S_FALSE;
        } else {
            renderer = SDL_CreateRenderer(window, -1, SDL_RENDERER_SOFTWARE);
            if (renderer == NULL) {
                printf("Renderer could not be created! SDL_Error: %s\n", SDL_GetError());
                nResult = S_FALSE;
            }
        }
    }

    if (nResult == S_OK && imageSurface != NULL) {
        // Create a texture from the loaded surface
        imageTexture = SDL_CreateTexture(renderer, SDL_PIXELFORMAT_RGBA8888, SDL_TEXTUREACCESS_TARGET, SCREEN_WIDTH, SCREEN_HEIGHT);
        if (imageTexture == NULL) {
            printf("Unable to create texture! SDL_Error: %s\n", SDL_GetError());
            nResult = S_FALSE;
        } else{
            // Set the new texture as the render target
            SDL_SetRenderTarget(renderer, imageTexture);

            // Clear screen
            SDL_SetRenderDrawColor(renderer, 0xFF, 0xFF, 0xFF, 0xFF); // White
            SDL_RenderClear(renderer);

            for (int i = 0; i < sizeof(g_objects) / sizeof(g_objects[0]); i++) {
                Sprite_draw0(g_objects[i], renderer);
            }

            // Reset the render target to the default
            SDL_SetRenderTarget(renderer, NULL);
        }
    }

    // Initialize SDL_image
    if (nResult == S_OK && !(IMG_Init(IMG_INIT_PNG) & IMG_INIT_PNG)) {
        printf("SDL_image could not initialize! SDL_image Error: %s\n", IMG_GetError());
        nResult = S_FALSE;
    }

    for( int i = 0; i < sizeof( g_objects ) / sizeof( g_objects[ 0 ] ) && nResult == S_OK; i++ ){
        if( Sprite_load( g_objects[ i ], renderer ) == false ){
            nResult = S_FALSE;
        }
    }

    ContextImpl context = ContextImpl_Ctor( ContextImpl_Init( ), );
    ContextImpl_Start( &context );
    SaveAllImages();
    ReleaseAllImages();

    if (nResult == S_OK) {
        bool quit = false;
        SDL_Event e;

        while (!quit) {
            while (SDL_PollEvent(&e) != 0) {
                if (e.type == SDL_QUIT) {
                    quit = true;
                } else if (e.type == SDL_KEYDOWN) {
                    if (e.key.keysym.sym == SDLK_x) {
                        ResetActionCounter();
                        ContextImpl_EventProc(&context, ContextImpl_TMOUT, NULL);
                        SaveAllImages();
                        ReleaseAllImages();
                    }
                }
            }

            // Render the image texture
            if (imageTexture != NULL) {
                SDL_RenderCopy(renderer, imageTexture, NULL, NULL);
            }

            static int s_pos_x = 0;
            ImgSprite_setOffset( eastRedLight, s_pos_x--, 0 );
            static double s_angle = 0;
            ImgSprite_setRotation( eastRedLight, s_angle += 1. );

            for (int i = 0; i < sizeof(g_objects) / sizeof(g_objects[0]); i++) {
                Sprite_update(g_objects[i]);
            }

            for (int i = 0; i < sizeof(g_objects) / sizeof(g_objects[0]); i++) {
                Sprite_draw1(g_objects[i], renderer);
            }

            // Update the screen
            SDL_RenderPresent(renderer);

            // Delay to control the animation speed
            SDL_Delay(50);
        }
    }

    for (int i = 0; i < sizeof(g_objects) / sizeof(g_objects[0]); i++) {
        Sprite_free(g_objects[i]);
    }

    // Free resources and close SDL
    SDL_DestroyTexture(imageTexture);
    SDL_FreeSurface(imageSurface);
    ReleaseAllImages();
    SDL_DestroyRenderer(renderer);
    SDL_DestroyWindow(window);
    IMG_Quit();
    SDL_Quit();

    return 0;
} /* ObjsBuilder_startSim */

ObjsBuilder* ObjsBuilder_Copy( ObjsBuilder* pObjsBuilder, const ObjsBuilder* pSource ){
    return ( ObjsBuilder* )pObjsBuilder;
}
