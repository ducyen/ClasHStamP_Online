/* File generated by Đức's ClasHStamP */
#define __ObjsBuilder_INTERNAL__
#include "CommonInclude.h"
#include "ObjsBuilder.h"
#include "RedLight.h"                                           
#include "ContextImpl.h"                                        
static Sprite g_objects[] = {
    { RedLight_Init(
        P( { 0.19223826714801445, 0.5508169778963414, 0.09476534296028881, 0.1798780487804878 } ),
        P( "RedLight.png" )) 
    },
    { RedLight_Init(
        P( { 0.8592057761732852, 0.7550852705792683, 0.09476534296028881, 0.20121951219512196 } ),
        P( "RedLight.png" )) 
    }
};
Sprite* getobj( int id ){
    return &g_objects[ id ];
}
int ObjsBuilder_startSim(
    void  
){
    SDL_Window *window = NULL;
    SDL_Surface *screenSurface = NULL;
    SDL_Surface *imageSurface = NULL;
    SDL_Surface *transformedSurface = NULL;

    int nResult = S_OK;

    if( nResult == S_OK && SDL_Init(SDL_INIT_VIDEO) < 0 ){
        printf("SDL could not initialize! SDL_Error: %s\n", SDL_GetError());
        nResult == S_FALSE;
    }

    if( nResult == S_OK ){
        // Load image
        char sRelPath[ 256 ];
        sprintf( sRelPath, "%s/%s", getInputDir(), "ObjsBuilder/Main.png" );
        imageSurface = IMG_Load(sRelPath);
        if (imageSurface == NULL) {
            printf("Unable to load image! SDL_image Error: %s\n", IMG_GetError());
            nResult = S_FALSE;
        }
    }

    int SCREEN_WIDTH  = 640;
    int SCREEN_HEIGHT = 480;
    if( nResult == S_OK ){
        SCREEN_WIDTH = imageSurface->w;
        SCREEN_HEIGHT = imageSurface->h;
        window = SDL_CreateWindow("SDL Tutorial", SDL_WINDOWPOS_UNDEFINED,
                                  SDL_WINDOWPOS_UNDEFINED, SCREEN_WIDTH,
                                  SCREEN_HEIGHT, SDL_WINDOW_SHOWN);
        if (window == NULL) {
            printf("Window could not be created! SDL_Error: %s\n", SDL_GetError());
            nResult = S_FALSE;
        }
    }
    if( nResult == S_OK ){
        screenSurface = SDL_GetWindowSurface(window);
        // Initialize SDL_image
        if (!(IMG_Init(IMG_INIT_PNG) & IMG_INIT_PNG)) {
            printf("SDL_image could not initialize! SDL_image Error: %s\n", IMG_GetError());
            nResult = S_FALSE;
        } 
    }

    for( int i = 0; i < sizeof( g_objects ) / sizeof( g_objects[ 0 ] ) && nResult == S_OK; i++ ){
        if( nResult == S_OK && Sprite_load( &g_objects[ i ] ) == false ){
            nResult = S_FALSE;
        }
    }

    ContextImpl context = ContextImpl_Ctor( ContextImpl_Init( ), );
    ContextImpl_Start( &context );
    SaveAllImages();
    ReleaseAllImages();

    if( nResult == S_OK ){
        bool quit = false;
        SDL_Event e;

        while (!quit) {
            while (SDL_PollEvent(&e) != 0) {
                if (e.type == SDL_QUIT) {
                    quit = true;
                }else if (e.type == SDL_KEYDOWN) {
                    if( e.key.keysym.sym == SDLK_x ){
                        ResetActionCounter();
                        ContextImpl_EventProc( &context, ContextImpl_TMOUT, NULL);
                        SaveAllImages();
                        ReleaseAllImages();
                    }
                }
            }

            // Clear screen
        #if 1
            SDL_FillRect(screenSurface, NULL, SDL_MapRGB(screenSurface->format, 0xFF, 0xFF, 0xFF));
        #else
            SDL_BlitSurface(imageSurface, NULL, screenSurface, NULL);
        #endif


            for( int i = 0; i < sizeof( g_objects ) / sizeof( g_objects[ 0 ] ) && nResult == S_OK; i++ ){
                Sprite_draw( &g_objects[ i ], screenSurface );
            }
            // Update the surface
            SDL_UpdateWindowSurface(window);

            // Update transformations

            // Delay to control the animation speed
            SDL_Delay(50);
        }
    }

    for( int i = 0; i < sizeof( g_objects ) / sizeof( g_objects[ 0 ] ) && nResult == S_OK; i++ ){
        Sprite_free( &g_objects[ i ] );
    }

    // Free resources and close SDL
    SDL_FreeSurface(imageSurface);
    ReleaseAllImages();
    SDL_DestroyWindow(window);
    IMG_Quit();
    SDL_Quit();

    return 0;

} /* ObjsBuilder_startSim */

ObjsBuilder* ObjsBuilder_Copy( ObjsBuilder* pObjsBuilder, const ObjsBuilder* pSource ){
    return ( ObjsBuilder* )pObjsBuilder;
}
